<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.6.0.final using JasperReports Library version 6.6.0  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="report-position" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="0" bottomMargin="0" uuid="9ca9d851-6728-447d-b9e1-91ccd1b54823">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="see-kpi-pmtl"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<style name="Table_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table 1_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<subDataset name="query-table" uuid="56ba12d3-4d87-4a20-a342-7e4cee61637f">
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="pmtl"/>
		<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
		<parameter name="param_date_start" class="java.lang.String"/>
		<parameter name="param_date_end" class="java.lang.String"/>
		<parameter name="param_questionaire_type" class="java.lang.String"/>
		<parameter name="param_employee" class="java.lang.String"/>
		<parameter name="param_assessor" class="java.lang.String"/>
		<queryString>
			<![CDATA[SELECT 
 l.appraisal_level_name
, t.questionaire_type
, concat(es.emp_first_name,' ',es.emp_last_name) as emp_name
, p.position_code
, chief.chief_emp_name
, chief.chief_position
, DATE_FORMAT(STR_TO_DATE(  $P{param_date_start} , "%d/%m/%Y"),"%d %b %Y")  as date_start
, DATE_FORMAT(STR_TO_DATE(  $P{param_date_end} , "%d/%m/%Y"),"%d %b %Y")   as date_end
FROM employee_snapshot es
LEFT JOIN questionaire_data_header qdh ON es.emp_snapshot_id = qdh.emp_snapshot_id
LEFT JOIN position p ON es.position_id = p.position_id
LEFT JOIN appraisal_level l ON es.level_id = l.level_id
LEFT JOIN questionaire n ON qdh.questionaire_id = n.questionaire_id
LEFT JOIN questionaire_type t ON t.questionaire_type_id = $P{param_questionaire_type} 
LEFT JOIN ( 
 SELECT concat(em.emp_first_name,' ',em.emp_last_name) as chief_emp_name
 , em.emp_code
 , po.position_code as chief_position
 FROM employee_snapshot em
 INNER JOIN position po ON em.position_id = po.position_id
) chief ON chief.emp_code = es.chief_emp_code
WHERE es.emp_snapshot_id =  $P{param_employee} 
GROUP BY es.emp_snapshot_id
ORDER BY p.position_code]]>
		</queryString>
		<field name="appraisal_level_name" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="appraisal_level_name"/>
			<property name="com.jaspersoft.studio.field.tree.path" value="appraisal_level"/>
		</field>
		<field name="questionaire_type" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="questionaire_type"/>
			<property name="com.jaspersoft.studio.field.tree.path" value="questionaire_type"/>
		</field>
		<field name="emp_name" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="emp_name"/>
		</field>
		<field name="position_code" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="position_code"/>
			<property name="com.jaspersoft.studio.field.tree.path" value="position"/>
		</field>
		<field name="chief_emp_name" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="chief_emp_name"/>
		</field>
		<field name="chief_position" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="chief_position"/>
			<property name="com.jaspersoft.studio.field.tree.path" value="position"/>
		</field>
		<field name="date_start" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="date_start"/>
		</field>
		<field name="date_end" class="java.lang.String">
			<property name="com.jaspersoft.studio.field.label" value="date_end"/>
		</field>
	</subDataset>
	<parameter name="param_date_start" class="java.lang.String"/>
	<parameter name="param_date_end" class="java.lang.String"/>
	<parameter name="param_assessor" class="java.lang.String"/>
	<parameter name="param_questionaire_type" class="java.lang.String"/>
	<parameter name="subreport_path" class="java.lang.String"/>
	<parameter name="param_user" class="java.lang.String"/>
	<parameter name="param_employee" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT es.emp_snapshot_id,p.position_code  FROM employee_snapshot es
INNER JOIN position p on p.position_id = es.position_id
WHERE (emp_snapshot_id in( $P!{param_employee} ) OR '999999999' =  $P{param_employee})]]>
	</queryString>
	<field name="emp_snapshot_id" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.label" value="emp_snapshot_id"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="employee_snapshot"/>
	</field>
	<field name="position_code" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="position_code"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="position"/>
	</field>
	<group name="emp" isStartNewPage="true" isReprintHeaderOnEachPage="true" minHeightToStartNewPage="20">
		<groupExpression><![CDATA[$F{emp_snapshot_id}]]></groupExpression>
		<groupHeader>
			<band height="119">
				<componentElement>
					<reportElement x="1" y="0" width="800" height="105" uuid="bd53d9fb-3806-4641-bf5d-40b107bc321f">
						<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.VerticalRowLayout"/>
						<property name="com.jaspersoft.studio.table.style.table_header" value="Table 1_TH"/>
						<property name="com.jaspersoft.studio.table.style.column_header" value="Table 1_CH"/>
						<property name="com.jaspersoft.studio.table.style.detail" value="Table 1_TD"/>
					</reportElement>
					<jr:table xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
						<datasetRun subDataset="query-table" uuid="cf93f129-781b-494e-959e-add11ef5d76b">
							<datasetParameter name="param_assessor">
								<datasetParameterExpression><![CDATA[$P{param_assessor}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="param_date_start">
								<datasetParameterExpression><![CDATA[$P{param_date_start}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="param_date_end">
								<datasetParameterExpression><![CDATA[$P{param_date_end}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="param_employee">
								<datasetParameterExpression><![CDATA[$F{emp_snapshot_id}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="param_questionaire_type">
								<datasetParameterExpression><![CDATA[$P{param_questionaire_type}]]></datasetParameterExpression>
							</datasetParameter>
							<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
						</datasetRun>
						<jr:column width="800" uuid="8dc548b9-f87b-484d-b7ce-42d6831cf343">
							<property name="com.jaspersoft.studio.components.table.model.column.name" value="Column1"/>
							<jr:detailCell style="Table 1_TD" height="110">
								<box>
									<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								</box>
								<textField isStretchWithOverflow="true">
									<reportElement mode="Transparent" x="0" y="0" width="800" height="29" forecolor="#000000" backcolor="#F0F0F0" uuid="28de5fe2-e02a-4722-8b66-e943f4a740bf"/>
									<box>
										<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									</box>
									<textElement textAlignment="Left" verticalAlignment="Middle">
										<font fontName="BrowalliaUPC" size="18" isBold="false"/>
										<paragraph leftIndent="10" rightIndent="10"/>
									</textElement>
									<textFieldExpression><![CDATA["ตำแหน่ง:  "+ (( $F{appraisal_level_name}== null ) ? "-" : $F{appraisal_level_name})+"          ประเภท:  "+  (( $F{questionaire_type} == null ) ? "-" : $F{questionaire_type} )]]></textFieldExpression>
								</textField>
								<textField isStretchWithOverflow="true">
									<reportElement mode="Transparent" x="0" y="29" width="800" height="27" forecolor="#000000" backcolor="#F0F0F0" uuid="acd93e4f-9ccb-4cdc-9de3-a0352a391e54"/>
									<box>
										<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
										<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
									</box>
									<textElement textAlignment="Left" verticalAlignment="Middle">
										<font fontName="BrowalliaUPC" size="18" isBold="false"/>
										<paragraph leftIndent="10" rightIndent="10"/>
									</textElement>
									<textFieldExpression><![CDATA["ระยะเวลา: "+$F{date_start}+" - "+$F{date_end}]]></textFieldExpression>
								</textField>
								<textField isStretchWithOverflow="true">
									<reportElement x="0" y="56" width="800" height="27" uuid="e5fb8783-cf35-4577-bdf9-6d7eb85aadc2"/>
									<textElement>
										<font fontName="BrowalliaUPC" size="18" isBold="false"/>
										<paragraph leftIndent="10"/>
									</textElement>
									<textFieldExpression><![CDATA["ชื่อ: "+ (( $F{emp_name} == null ) ? "-" : $F{emp_name} )+"     รหัสตำแหน่ง:  "+  (( $F{position_code} == null ) ? "-" : $F{position_code} )]]></textFieldExpression>
								</textField>
								<textField isStretchWithOverflow="true">
									<reportElement x="0" y="83" width="800" height="27" uuid="0aa0ad3d-47bb-4074-8c2c-9a359f689f87"/>
									<textElement>
										<font fontName="BrowalliaUPC" size="18" isBold="false"/>
										<paragraph leftIndent="10"/>
									</textElement>
									<textFieldExpression><![CDATA["หัวหน้าปัจจุบัน:  "+(( $F{chief_emp_name} == null ) ? "-" : $F{chief_emp_name})+"          รหัสตำแหน่ง:  "+(( $F{chief_position} == null ) ? "-" : $F{chief_position} )]]></textFieldExpression>
								</textField>
							</jr:detailCell>
						</jr:column>
					</jr:table>
				</componentElement>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="106">
			<subreport>
				<reportElement x="-20" y="0" width="842" height="85" uuid="aef6398c-1bdc-4672-aec0-9fd17a22009d"/>
				<subreportParameter name="param_assessor">
					<subreportParameterExpression><![CDATA[$P{param_assessor}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="param_user">
					<subreportParameterExpression><![CDATA[$P{param_user}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="param_date_start">
					<subreportParameterExpression><![CDATA[$P{param_date_start}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="param_date_end">
					<subreportParameterExpression><![CDATA[$P{param_date_end}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="param_employee">
					<subreportParameterExpression><![CDATA[$F{emp_snapshot_id}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="param_questionaire_type">
					<subreportParameterExpression><![CDATA[$P{param_questionaire_type}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="subreport_path">
					<subreportParameterExpression><![CDATA[$P{subreport_path}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{subreport_path}+"/report-position-emp-subreport.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
</jasperReport>
